#! /bin/bash

#SBATCH --partition=Orion
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=30
#SBATCH --time=10-00:00:00
#SBATCH --mem=60GB
#SBATCH --mail-user=cnnamdi@charlotte.edu
#SBATCH --mail-type=ALL

echo "======================================================"
echo "Start Time  : $(date)"
echo "Submit Dir  : $SLURM_SUBMIT_DIR"
echo "Job ID/Name : $SLURM_JOBID : $SLURM_JOB_NAME"
echo "Node List   : $SLURM_JOB_NODELIST"
echo "Num Tasks   : $SLURM_NTASKS total [$SLURM_NNODES nodes @ $SLURM_CPUS_ON_NODE CPUs/node]"
echo "======================================================"
echo ""

module load parallel/20240422
pjl="parallel_jobs_log"

#=================================================================================
#
#=================================================================================

map_reads2() {
        echo ""
        echo "--------------------------------------"
        read_name=$(basename $1 | awk -F'_' '{print $1}')

        if [[ "$1" == *_1.fastq || "$1" == *_1.fastq.gz ]]; then
                read_name=$(basename $1 | awk -F'_' '{print $1}')
                read_2=$(echo $1 | sed 's/_1/_2/')
        elif [[ "$1" == *_R1.fastq || "$1" == *_R1.fastq.gz ]]; then
                read_name=$(basename $1 | awk -F'.' '{print $1}' | sed 's/_R1//')
                read_2=$(echo "$1" | sed 's/_R1/_R2/')
        else
                echo "Unrecognized read 1 format: $1" >&2
                return 1
        fi

        echo $read_name
        echo $1
        echo $read_2
	echo $2
        echo "--------------------------------------"
}


#reads_path="/projects/cooper_research1/Wild_Sorghum_WGS"
#map_reads2 $reads_path/Grif16309_1.fastq "mappings"

reads_path="/projects/cooper_research1/TERRA_RAW"
map_reads2 $reads_path/PI_673843_TCCGCGAA_R1.fastq.gz

#=================================================================================
#
#=================================================================================

vg_call() {
        echo ""
        echo "--------------------------------------"
        sample=$(basename $1 | awk -F'.' '{print $1}')

        echo $sample
        echo $1
	echo $2
	echo $2/$sample.vcf
        echo "--------------------------------------"

}

export -f vg_call

#find mappings/*gam | parallel -j 14 --joblog $pjl/sandbox_vg_call.txt vg_call {} "mappings"


#=================================================================================
#
#=================================================================================



#=================================================================================
#
#=================================================================================

#=================================================================================
#
#=================================================================================



#=================================================================================
#
#=================================================================================

#=================================================================================
#
#=================================================================================



#=================================================================================
#
#=================================================================================

#=================================================================================
#
#=================================================================================



#=================================================================================
#
#=================================================================================

#=================================================================================
#
#=================================================================================



#=================================================================================
#
#=================================================================================

echo ""
echo "======================================================"
echo "End Time   : $(date)"
echo "======================================================"
